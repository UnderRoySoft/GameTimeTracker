<!-- MainWindow.xaml -->
<Window x:Class="Tracker.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="GameTimeTracker" Height="520" Width="820">

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Tabs -->
        <TabControl x:Name="MainTabControl"
                    Grid.Row="0"
                    SelectionChanged="TabControl_SelectionChanged">

            <TabItem Header="Dashboard">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Width="120" Height="28" Content="Refresh" Click="DashboardRefresh_Click"/>
                    </StackPanel>

                    <DataGrid Grid.Row="1"
          ItemsSource="{Binding Dashboard.Games}"
          AutoGenerateColumns="False"
          IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Game" Binding="{Binding GameName}" Width="*"/>
                            <DataGridTextColumn Header="Active" Binding="{Binding ActiveFormatted}" Width="120"/>
                            <DataGridTextColumn Header="Idle" Binding="{Binding IdleFormatted}" Width="120"/>

                            <!-- ✅ NEW: Delete button -->
                            <DataGridTemplateColumn Header="" Width="90">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Delete"
                            Height="22"
                            Command="{Binding DataContext.Dashboard.DeleteGameCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            CommandParameter="{Binding GameId}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="Rules">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Add rule (EXE name only, e.g. witcher.exe)" FontWeight="SemiBold"/>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,8">
                        <TextBox Width="220" Height="28" Margin="0,0,8,0"
                                 Text="{Binding Rules.GameName, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBox Width="180" Height="28" Margin="0,0,8,0"
                                 Text="{Binding Rules.ExeName, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBox Width="80" Height="28" Margin="0,0,8,0"
                                 Text="{Binding Rules.Priority, UpdateSourceTrigger=PropertyChanged}" />

                        <Button Width="120" Height="28" Content="Add"
                                Command="{Binding Rules.AddCommand}" />

                        <Button Width="120" Height="28" Margin="8,0,0,0" Content="Refresh"
                                Click="RulesRefresh_Click" />
                    </StackPanel>

                    <ListBox Grid.Row="2" ItemsSource="{Binding Rules.Items}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="220"/>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="90"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding GameName}" />
                                    <TextBlock Grid.Column="1" Text="{Binding ExecutableName}" />
                                    <TextBlock Grid.Column="2" Text="{Binding Priority}" />

                                    <Button Grid.Column="3"
                        Width="80"
                        Height="22"
                        Content="Delete"
                        Command="{Binding DataContext.Rules.DeleteCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                        CommandParameter="{Binding RuleId}" />
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status line -->
        <TextBlock Grid.Row="1"
                   Margin="0,8,0,0"
                   Opacity="0.7"
                   Text="{Binding UiStatus}" />
    </Grid>
</Window>